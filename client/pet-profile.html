<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pet Profile</title>
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inria+Serif&family=Joan&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <img id="pet-image" class="pet-image" alt="Pet Image" />
    <div id="pet-name" class="pet-name"></div>
    <div id="pet-age" class="pet-age"></div>
    <div id="pet-description" class="pet-description"></div>
    <div id="breed-link-box" class="breed-link" style="display: none;">
      if you wanna know more about <a id="breed-link" href="#" target="_blank">breed</a>, click on the link
    </div>

    <a id="adopt-btn" href="#" class="adopt-button">
      Take me home!
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 2C11.45 2 11 2.45 11 3V17.59L5.7 12.29C5.31 11.9 4.68 11.9 4.29 12.29C3.9 12.68 3.9 13.31 4.29 13.7L11.3 20.71C11.69 21.1 12.32 21.1 12.71 20.71L19.71 13.7C20.1 13.31 20.1 12.68 19.71 12.29C19.32 11.9 18.69 11.9 18.3 12.29L13 17.59V3C13 2.45 12.55 2 12 2Z"/>
      </svg>
    </a>
  </div>

  <script>
  const pet = JSON.parse(localStorage.getItem("selectedPet"));

  if (!pet) {
    document.querySelector(".container").innerHTML = "<p>Pet not found 😢</p>";
  } else {
    // נבדוק האם החיה עדיין קיימת במסד
    fetch("/api/pets")
      .then(res => res.json())
      .then(pets => {
        const match = pets.find(p => p.id === pet.id || p._id === pet.id); // בדיקה לפי id או _id
        if (!match) {
          document.querySelector(".container").innerHTML = "<p>This pet has already been adopted 🐾</p>";
        } else {
          document.getElementById("pet-image").src = pet.image;
          document.getElementById("pet-name").textContent = pet.name;
          document.getElementById("pet-age").textContent = pet.age;
          document.getElementById("pet-description").textContent = pet.description;

          if (pet.infoLink) {
            const link = document.getElementById("breed-link");
            link.href = pet.infoLink;
            link.textContent = `"${pet.breed}"`;
            document.getElementById("breed-link-box").style.display = "block";
          }

          const adoptButton = document.querySelector(".adopt-button");
          if (adoptButton && pet.id) {
            adoptButton.href = `adoption-form.html?id=${pet.id}`;
          }
        }
      })
      .catch(err => {
        console.error("Error verifying pet existence:", err);
        document.querySelector(".container").innerHTML = "<p>Server error. Please try again later.</p>";
      });
  }
</script>
</body>
</html>
