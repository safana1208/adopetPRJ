<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AdoPet - Pets</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <h1 class="page-title">Available Pets üêæ</h1>
  <div class="grid" id="pet-container"></div>

  <script>
    const container = document.getElementById("pet-container");
    const answers = JSON.parse(localStorage.getItem("questionnaireAnswers")) || {};

    function normalize(str) {
      return (str || "").toLowerCase().trim();
    }

    function matchesFilter(pet) {
      const breedLower = normalize(pet.breed);
      const nameLower = normalize(pet.name);
      const typeLower = normalize(pet.type);
      const ageText = normalize(pet.age);
      const sizeLower = normalize(pet.size);
      const furLower = normalize(pet.shedding);

      // Filter by type
      if (answers.type && answers.type !== "any" && normalize(answers.type) !== typeLower) return false;

      // Filter by age
      if (answers.age === "kitten" && !ageText.includes("month")) return false;
      if (answers.age === "adult" && !(ageText.includes("year") && parseInt(ageText) < 6)) return false;
      if (answers.age === "senior" && !(ageText.includes("year") && parseInt(ageText) >= 6)) return false;

      // Filter by breed
      if (answers.breed === "specific" && answers.breedName) {
        if (!breedLower.includes(normalize(answers.breedName))) return false;
      } else if (answers.breed === "mixed") {
        if (!breedLower.includes("mixed")) return false;
      }

      // Filter by size
      if (answers.size && normalize(answers.size) !== sizeLower) return false;

      // Filter by fur
      if (answers.fur && answers.fur !== "dont-mind" && normalize(answers.fur) !== furLower) return false;

      return true;
    }

    fetch("/api/pets")
      .then(res => res.json())
      .then(pets => {
        pets.filter(matchesFilter).forEach(pet => {
          const card = document.createElement("div");
          card.className = "pet-card";
          card.innerHTML = `
            <img src="${pet.image}" alt="${pet.name}">
            <div class="pet-info-row">
              <span class="pet-name">${pet.name}</span>
              <span class="pet-age">${pet.age}</span>
            </div>
            <div class="pet-breed-label">Breed:</div>
            <div class="pet-breed-box">${pet.breed}</div>
          `;

          card.addEventListener("click", () => {
            localStorage.setItem("selectedPet", JSON.stringify(pet));
            window.location.href = "pet-profile.html";
          });

          container.appendChild(card);
        });
      })
      .catch(err => {
        console.error("Failed to load pets:", err);
        container.innerHTML = "<p>Server error while loading pets üò¢</p>";
      });
  </script>
</body>
</html>
